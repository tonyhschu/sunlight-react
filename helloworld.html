<!DOCTYPE html>
<html>
  <head>
    <script src="js-lib/jquery-2.1.0.min.js"></script>
    <script src="js-lib/underscore-min.js"></script>
    <script src="js-lib/backbone-min.js"></script>
    <script src="build/react.js"></script>
    <script src="build/JSXTransformer.js"></script>
    <script src="js-lib/react.backbone.js"></script>
    <style type="text/css">
      #container {
        width: 80%;
        max-width: 70em;
        margin: 0 auto;
      }

      .BillList {
        width: 40%;
        float: left;
      }

      .BillPanel {
        width: 58%;
        float: right;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script type="text/jsx">
      /** @jsx React.DOM */
      var BillViewerModel = Backbone.Model.extend({

      })

      var BillsView = React.createClass({
        getInitialState: function() {
          return { data: [{question: "Loading. Hold Please."}], selected: 0 };
        },
        componentWillMount: function() {
          $.ajax({
            url: this.props.url,
            dataType: 'json',
            success: function(data) {
              this.setState({data: data.results});
              console.log(data);
            }.bind(this),
            error: function(xhr, status, err) {
              console.error(this.props.url, status, err.toString());
            }.bind(this)
          });
        },
        componentDidMount: function() {
          window.onClick(function() {
            this.setState({ selected: 9 });
          })
        },
        render: function() {
          return (
            <div className="Bills">
              <BillListView data={this.state.data} />
              <BillPanelView selected={this.state.selected}/>
            </div>
          )
        }
      })

      var BillCollectionView = React.createClass({
        render: function() {
          var billNodes = this.props.data.map(function (bill, index) {
            return <BillEntryView key={index} title={bill.question} />;
          });
          return <ul className="BillList">{billNodes}</ul>;
        }
      });

      var BillEntryView = React.createClass({
        handleClick: function(event) {
          console.log(this.props.key);
        },
        render: function() {
          return (
            <li className="BillEntry" onClick={this.handleClick}>
              {this.props.title}
            </li>
          )
        }
      });

      var BillPanelView = React.createClass({
        componentWillMount: function() {
          console.log("heeeeyo?");
        },
        render: function() {
          return (
            <div>{this.props.selected}</div>
          )
        }
      })

      React.renderComponent(
        <BillsView url={"http://congress.api.sunlightfoundation.com/votes?breakdown.total.Yea__gte=200&chamber=house&congress=112&apikey=5ee3fecf84784ccf8bfbd61a67c82750&fields=question,voter_ids,source"} />,
        document.getElementById('container')
      );
    </script>
  </body>
</html>
